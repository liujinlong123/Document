<!DOCTYPE html>
<!-- saved from url=(0083)https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Soong</title><link rel="stylesheet" type="text/css" href="./Soong_files/base.FgwOs7Bvh5E6-lzR-xJuUQ.cache.css"><link rel="stylesheet" type="text/css" href="./Soong_files/doc.aizEIcp0qpW8JIXIrCB9UQ.cache.css"><link rel="stylesheet" type="text/css" href="./Soong_files/prettify.AOMOBqJIPcDq491E2ExAAw.cache.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header Site-header--withNavbar"><div class="Header"><div class="Header-title"></div></div><nav class="Header-nav" role="navigation"><ul><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md">Home</a></li><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/best_practices.md">Best Practices</a></li><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/perf.md">Performance</a></li></ul></nav></header><div class="Site-content Site-Content--markdown"><div class="Container"><div class="doc"><h1><a class="h" name="Soong" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Soong"><span></span></a><a class="h" name="soong" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#soong"><span></span></a>Soong</h1><p>Soong is the replacement for the old Android make-based build system.  It replaces Android.mk files with Android.bp files, which are JSON-like simple declarative descriptions of modules to build.</p><p>See <a href="https://source.android.com/compatibility/tests/development/blueprints">Simple Build Configuration</a> on source.android.com to read how Soong is configured for testing.</p><h2><a class="h" name="Android_bp-file-format" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Android_bp-file-format"><span></span></a><a class="h" name="android_bp-file-format" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#android_bp-file-format"><span></span></a>Android.bp file format</h2><p>By design, Android.bp files are very simple.  There are no conditionals or control flow statements - any complexity is handled in build logic written in Go.  The syntax and semantics of Android.bp files are intentionally similar to <a href="https://www.bazel.io/versions/master/docs/be/overview.html">Bazel BUILD files</a> when possible.</p><h3><a class="h" name="Modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Modules"><span></span></a><a class="h" name="modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#modules"><span></span></a>Modules</h3><p>A module in an Android.bp file starts with a module type, followed by a set of properties in <code class="code">name: value,</code> format:</p><pre class="code">cc_binary {
    name: "gzip",
    srcs: ["src/test/minigzip.c"],
    shared_libs: ["libz"],
    stl: "none",
}
</pre><p>Every module must have a <code class="code">name</code> property, and the value must be unique across all Android.bp files.</p><p>For a list of valid module types and their properties see <a href="https://ci.android.com/builds/latest/branches/aosp-build-tools/targets/linux/view/soong_build.html">$OUT_DIR/soong/docs/soong_build.html</a>.</p><h3><a class="h" name="File-lists" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#File-lists"><span></span></a><a class="h" name="file-lists" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#file-lists"><span></span></a>File lists</h3><p>Properties that take a list of files can also take glob patterns and output path expansions.</p><ul><li><p>Glob patterns can contain the normal Unix wildcard <code class="code">*</code>, for example <code class="code">"*.java"</code>.</p><p>Glob patterns can also contain a single <code class="code">**</code> wildcard as a path element, which will match zero or more path elements. For example, <code class="code">java/**/*.java</code> will match <code class="code">java/Main.java</code> and <code class="code">java/com/android/Main.java</code>.</p></li><li><p>Output path expansions take the format <code class="code">:module</code> or <code class="code">:module{.tag}</code>, where <code class="code">module</code> is the name of a module that produces output files, and it expands to a list of those output files. With the optional <code class="code">{.tag}</code> suffix, the module may produce a different list of outputs according to <code class="code">tag</code>.</p><p>For example, a <code class="code">droiddoc</code> module with the name “my-docs” would return its <code class="code">.stubs.srcjar</code> output with <code class="code">":my-docs"</code>, and its <code class="code">.doc.zip</code> file with <code class="code">":my-docs{.doc.zip}"</code>.</p><p>This is commonly used to reference <code class="code">filegroup</code> modules, whose output files consist of their <code class="code">srcs</code>.</p></li></ul><h3><a class="h" name="Variables" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Variables"><span></span></a><a class="h" name="variables" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#variables"><span></span></a>Variables</h3><p>An Android.bp file may contain top-level variable assignments:</p><pre class="code">gzip_srcs = ["src/test/minigzip.c"],

cc_binary {
    name: "gzip",
    srcs: gzip_srcs,
    shared_libs: ["libz"],
    stl: "none",
}
</pre><p>Variables are scoped to the remainder of the file they are declared in, as well as any child Android.bp files.  Variables are immutable with one exception - they can be appended to with a += assignment, but only before they have been referenced.</p><h3><a class="h" name="Comments" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Comments"><span></span></a><a class="h" name="comments" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#comments"><span></span></a>Comments</h3><p>Android.bp files can contain C-style multiline <code class="code">/* */</code> and C++ style single-line <code class="code">//</code> comments.</p><h3><a class="h" name="Types" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Types"><span></span></a><a class="h" name="types" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#types"><span></span></a>Types</h3><p>Variables and properties are strongly typed, variables dynamically based on the first assignment, and properties statically by the module type.  The supported types are:</p><ul><li>Bool (<code class="code">true</code> or <code class="code">false</code>)</li><li>Integers (<code class="code">int</code>)</li><li>Strings (<code class="code">"string"</code>)</li><li>Lists of strings (<code class="code">["string1", "string2"]</code>)</li><li>Maps (<code class="code">{key1: "value1", key2: ["value2"]}</code>)</li></ul><p>Maps may values of any type, including nested maps.  Lists and maps may have trailing commas after the last value.</p><p>Strings can contain double quotes using <code class="code">\"</code>, for example <code class="code">"cat \"a b\""</code>.</p><h3><a class="h" name="Operators" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Operators"><span></span></a><a class="h" name="operators" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#operators"><span></span></a>Operators</h3><p>Strings, lists of strings, and maps can be appended using the <code class="code">+</code> operator. Integers can be summed up using the <code class="code">+</code> operator. Appending a map produces the union of keys in both maps, appending the values of any keys that are present in both maps.</p><h3><a class="h" name="Defaults-modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Defaults-modules"><span></span></a><a class="h" name="defaults-modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#defaults-modules"><span></span></a>Defaults modules</h3><p>A defaults module can be used to repeat the same properties in multiple modules. For example:</p><pre class="code">cc_defaults {
    name: "gzip_defaults",
    shared_libs: ["libz"],
    stl: "none",
}

cc_binary {
    name: "gzip",
    defaults: ["gzip_defaults"],
    srcs: ["src/test/minigzip.c"],
}
</pre><h3><a class="h" name="Packages" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Packages"><span></span></a><a class="h" name="packages" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#packages"><span></span></a>Packages</h3><p>The build is organized into packages where each package is a collection of related files and a specification of the dependencies among them in the form of modules.</p><p>A package is defined as a directory containing a file named <code class="code">Android.bp</code>, residing beneath the top-level directory in the build and its name is its path relative to the top-level directory. A package includes all files in its directory, plus all subdirectories beneath it, except those which themselves contain an <code class="code">Android.bp</code> file.</p><p>The modules in a package's <code class="code">Android.bp</code> and included files are part of the module.</p><p>For example, in the following directory tree (where <code class="code">.../android/</code> is the top-level Android directory) there are two packages, <code class="code">my/app</code>, and the subpackage <code class="code">my/app/tests</code>. Note that <code class="code">my/app/data</code> is not a package, but a directory belonging to package <code class="code">my/app</code>.</p><pre class="code">.../android/my/app/Android.bp
.../android/my/app/app.cc
.../android/my/app/data/input.txt
.../android/my/app/tests/Android.bp
.../android/my/app/tests/test.cc
</pre><p>This is based on the Bazel package concept.</p><p>The <code class="code">package</code> module type allows information to be specified about a package. Only a single <code class="code">package</code> module can be specified per package and in the case where there are multiple <code class="code">.bp</code> files in the same package directory it is highly recommended that the <code class="code">package</code> module (if required) is specified in the <code class="code">Android.bp</code> file.</p><p>Unlike most module type <code class="code">package</code> does not have a <code class="code">name</code> property. Instead the name is set to the name of the package, e.g. if the package is in <code class="code">top/intermediate/package</code> then the package name is <code class="code">//top/intermediate/package</code>.</p><p>E.g. The following will set the default visibility for all the modules defined in the package and any subpackages that do not set their own default visibility (irrespective of whether they are in the same <code class="code">.bp</code> file as the <code class="code">package</code> module) to be visible to all the subpackages by default.</p><pre class="code">package {
    default_visibility: [":__subpackages"]
}
</pre><h3><a class="h" name="Referencing-Modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Referencing-Modules"><span></span></a><a class="h" name="referencing-modules" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#referencing-modules"><span></span></a>Referencing Modules</h3><p>A module <code class="code">libfoo</code> can be referenced by its name</p><pre class="code">cc_binary {
    name: "app",
    shared_libs: ["libfoo"],
}
</pre><p>Obviously, this works only if there is only one <code class="code">libfoo</code> module in the source tree. Ensuring such name uniqueness for larger trees may become problematic. We might also want to use the same name in multiple mutually exclusive subtrees (for example, implementing different devices) deliberately in order to describe a functionally equivalent module. Enter Soong namespaces.</p><h4><a class="h" name="Namespaces" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Namespaces"><span></span></a><a class="h" name="namespaces" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#namespaces"><span></span></a>Namespaces</h4><p>A presense of the <code class="code">soong_namespace {..}</code> in an Android.bp file defines a <strong>namespace</strong>. For instance, having</p><pre class="code">soong_namespace {
    ...
}
...
</pre><p>in <code class="code">device/google/bonito/Android.bp</code> informs Soong that within the <code class="code">device/google/bonito</code> package the module names are unique, that is, all the modules defined in the Android.bp files in the <code class="code">device/google/bonito/</code> tree have unique names. However, there may be modules with the same names outside <code class="code">device/google/bonito</code> tree. Indeed, there is a module <code class="code">"pixelstats-vendor"</code> both in <code class="code">device/google/bonito/pixelstats</code> and in <code class="code">device/google/coral/pixelstats</code>.</p><p>The name of a namespace is the path of its directory. The name of the namespace in the example above is thus <code class="code">device/google/bonito</code>.</p><p>An implicit <strong>global namespace</strong> corresponds to the source tree as a whole. It has empty name.</p><p>A module name's <strong>scope</strong> is the smallest namespace containing it. Suppose a source tree has <code class="code">device/my</code> and <code class="code">device/my/display</code> namespaces. If <code class="code">libfoo</code> module is defined in <code class="code">device/co/display/lib/Android.bp</code>, its namespace is <code class="code">device/co/display</code>.</p><p>The name uniqueness thus means that module‘s name is unique within its scope. In other words, “//<em>scope</em>:<em>name</em>” is globally unique module reference, e.g, <code class="code">"//device/google/bonito:pixelstats-vendor"</code>. <em>Note</em> that the name of the namespace for a module may be different from module’s package name: <code class="code">libfoo</code> belongs to <code class="code">device/my/display</code> namespace but is contained in <code class="code">device/my/display/lib</code> package.</p><h4><a class="h" name="Name-Resolution" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Name-Resolution"><span></span></a><a class="h" name="name-resolution" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#name-resolution"><span></span></a>Name Resolution</h4><p>The form of a module reference determines how Soong locates the module.</p><p>For a <strong>global reference</strong> of the “//<em>scope</em>:<em>name</em>” form, Soong verifies there is a namespace called “<em>scope</em>”, then verifies it contains a “<em>name</em>” module and uses it. Soong verifies there is only one “<em>name</em>” in “<em>scope</em>” at the beginning when it parses Android.bp files.</p><p>A <strong>local reference</strong> has “<em>name</em>” form, and resolving it involves looking for a module “<em>name</em>” in one or more namespaces. By default only the global namespace is searched for “<em>name</em>” (in other words, only the modules not belonging to an explicitly defined scope are considered). The <code class="code">imports</code> attribute of the <code class="code">soong_namespaces</code> allows to specify where to look for modules . For instance, with <code class="code">device/google/bonito/Android.bp</code> containing</p><pre class="code">soong_namespace {
    imports: [
        "hardware/google/interfaces",
        "hardware/google/pixel",
        "hardware/qcom/bootctrl",
    ],
}
</pre><p>a reference to <code class="code">"libpixelstats"</code> will resolve to the module defined in <code class="code">hardware/google/pixel/pixelstats/Android.bp</code> because this module is in <code class="code">hardware/google/pixel</code> namespace.</p><p><strong>TODO</strong>: Conventionally, languages with similar concepts provide separate constructs for namespace definition and name resolution (<code class="code">namespace</code> and <code class="code">using</code> in C++, for instance). Should Soong do that, too?</p><h4><a class="h" name="Referencing-modules-in-makefiles" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Referencing-modules-in-makefiles"><span></span></a><a class="h" name="referencing-modules-in-makefiles" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#referencing-modules-in-makefiles"><span></span></a>Referencing modules in makefiles</h4><p>While we are gradually converting makefiles to Android.bp files, Android build is described by a mixture of Android.bp and Android.mk files, and a module defined in an Android.mk file can reference a module defined in Android.bp file. For instance, a binary still defined in an Android.mk file may have a library defined in already converted Android.bp as a dependency.</p><p>A module defined in an Android.bp file and belonging to the global namespace can be referenced from a makefile without additional effort. If a module belongs to an explicit namespace, it can be referenced from a makefile only after after the name of the namespace has been added to the value of PRODUCT_SOONG_NAMESPACES variable.</p><p>Note that makefiles have no notion of namespaces and exposing namespaces with the same modules via PRODUCT_SOONG_NAMESPACES may cause Make failure. For instance, exposing both <code class="code">device/google/bonito</code> and <code class="code">device/google/coral</code> namespaces will cause Make failure because it will see two targets for the <code class="code">pixelstats-vendor</code> module.</p><h3><a class="h" name="Visibility" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Visibility"><span></span></a><a class="h" name="visibility" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#visibility"><span></span></a>Visibility</h3><p>The <code class="code">visibility</code> property on a module controls whether the module can be used by other packages. Modules are always visible to other modules declared in the same package. This is based on the Bazel visibility mechanism.</p><p>If specified the <code class="code">visibility</code> property must contain at least one rule.</p><p>Each rule in the property must be in one of the following forms:</p><ul><li><code class="code">["//visibility:public"]</code>: Anyone can use this module.</li><li><code class="code">["//visibility:private"]</code>: Only rules in the module's package (not its subpackages) can use this module.</li><li><code class="code">["//visibility:override"]</code>: Discards any rules inherited from defaults or a creating module. Can only be used at the beginning of a list of visibility rules.</li><li><code class="code">["//some/package:__pkg__", "//other/package:__pkg__"]</code>: Only modules in <code class="code">some/package</code> and <code class="code">other/package</code> (defined in <code class="code">some/package/*.bp</code> and <code class="code">other/package/*.bp</code>) have access to this module. Note that sub-packages do not have access to the rule; for example, <code class="code">//some/package/foo:bar</code> or <code class="code">//other/package/testing:bla</code> wouldn't have access. <code class="code">__pkg__</code> is a special module and must be used verbatim. It represents all of the modules in the package.</li><li><code class="code">["//project:__subpackages__", "//other:__subpackages__"]</code>: Only modules in packages <code class="code">project</code> or <code class="code">other</code> or in one of their sub-packages have access to this module. For example, <code class="code">//project:rule</code>, <code class="code">//project/library:lib</code> or <code class="code">//other/testing/internal:munge</code> are allowed to depend on this rule (but not <code class="code">//independent:evil</code>)</li><li><code class="code">["//project"]</code>: This is shorthand for <code class="code">["//project:__pkg__"]</code></li><li><code class="code">[":__subpackages__"]</code>: This is shorthand for <code class="code">["//project:__subpackages__"]</code> where <code class="code">//project</code> is the module's package, e.g. using <code class="code">[":__subpackages__"]</code> in <code class="code">packages/apps/Settings/Android.bp</code> is equivalent to <code class="code">//packages/apps/Settings:__subpackages__</code>.</li><li><code class="code">["//visibility:legacy_public"]</code>: The default visibility, behaves as <code class="code">//visibility:public</code> for now. It is an error if it is used in a module.</li></ul><p>The visibility rules of <code class="code">//visibility:public</code> and <code class="code">//visibility:private</code> cannot be combined with any other visibility specifications, except <code class="code">//visibility:public</code> is allowed to override visibility specifications imported through the <code class="code">defaults</code> property.</p><p>Packages outside <code class="code">vendor/</code> cannot make themselves visible to specific packages in <code class="code">vendor/</code>, e.g. a module in <code class="code">libcore</code> cannot declare that it is visible to say <code class="code">vendor/google</code>, instead it must make itself visible to all packages within <code class="code">vendor/</code> using <code class="code">//vendor:__subpackages__</code>.</p><p>If a module does not specify the <code class="code">visibility</code> property then it uses the <code class="code">default_visibility</code> property of the <code class="code">package</code> module in the module's package.</p><p>If the <code class="code">default_visibility</code> property is not set for the module's package then it will use the <code class="code">default_visibility</code> of its closest ancestor package for which a <code class="code">default_visibility</code> property is specified.</p><p>If no <code class="code">default_visibility</code> property can be found then the module uses the global default of <code class="code">//visibility:legacy_public</code>.</p><p>The <code class="code">visibility</code> property has no effect on a defaults module although it does apply to any non-defaults module that uses it. To set the visibility of a defaults module, use the <code class="code">defaults_visibility</code> property on the defaults module; not to be confused with the <code class="code">default_visibility</code> property on the package module.</p><p>Once the build has been completely switched over to soong it is possible that a global refactoring will be done to change this to <code class="code">//visibility:private</code> at which point all packages that do not currently specify a <code class="code">default_visibility</code> property will be updated to have <code class="code">default_visibility = [//visibility:legacy_public]</code> added. It will then be the owner's responsibility to replace that with a more appropriate visibility.</p><h3><a class="h" name="Formatter" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Formatter"><span></span></a><a class="h" name="formatter" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#formatter"><span></span></a>Formatter</h3><p>Soong includes a canonical formatter for Android.bp files, similar to <a href="https://golang.org/cmd/gofmt/">gofmt</a>.  To recursively reformat all Android.bp files in the current directory:</p><pre class="code">bpfmt -w .
</pre><p>The canonical format includes 4 space indents, newlines after every element of a multi-element list, and always includes a trailing comma in lists and maps.</p><h3><a class="h" name="Convert-Android_mk-files" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Convert-Android_mk-files"><span></span></a><a class="h" name="convert-android_mk-files" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#convert-android_mk-files"><span></span></a>Convert Android.mk files</h3><p>Soong includes a tool perform a first pass at converting Android.mk files to Android.bp files:</p><pre class="code">androidmk Android.mk &gt; Android.bp
</pre><p>The tool converts variables, modules, comments, and some conditionals, but any custom Makefile rules, complex conditionals or extra includes must be converted by hand.</p><h4><a class="h" name="Differences-between-Android_mk-and-Android_bp" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Differences-between-Android_mk-and-Android_bp"><span></span></a><a class="h" name="differences-between-android_mk-and-android_bp" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#differences-between-android_mk-and-android_bp"><span></span></a>Differences between Android.mk and Android.bp</h4><ul><li>Android.mk files often have multiple modules with the same name (for example for static and shared version of a library, or for host and device versions). Android.bp files require unique names for every module, but a single module can be built in multiple variants, for example by adding <code class="code">host_supported: true</code>. The androidmk converter will produce multiple conflicting modules, which must be resolved by hand to a single module with any differences inside <code class="code">target: { android: { }, host: { } }</code> blocks.</li></ul><h3><a class="h" name="Conditionals" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Conditionals"><span></span></a><a class="h" name="conditionals" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#conditionals"><span></span></a>Conditionals</h3><p>Soong deliberately does not support most conditionals in Android.bp files.  We suggest removing most conditionals from the build.  See <a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/best_practices.md#removing-conditionals">Best Practices</a> for some examples on how to remove conditionals.</p><p>Most conditionals supported natively by Soong are converted to a map property.  When building the module one of the properties in the map will be selected, and its values appended to the property with the same name at the top level of the module.</p><p>For example, to support architecture specific files:</p><pre class="code">cc_library {
    ...
    srcs: ["generic.cpp"],
    arch: {
        arm: {
            srcs: ["arm.cpp"],
        },
        x86: {
            srcs: ["x86.cpp"],
        },
    },
}
</pre><p>When building the module for arm the <code class="code">generic.cpp</code> and <code class="code">arm.cpp</code> sources will be built.  When building for x86 the <code class="code">generic.cpp</code> and ‘x86.cpp’ sources will be built.</p><h4><a class="h" name="Soong-Config-Variables" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Soong-Config-Variables"><span></span></a><a class="h" name="soong-config-variables" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#soong-config-variables"><span></span></a>Soong Config Variables</h4><p>When converting vendor modules that contain conditionals, simple conditionals can be supported through Soong config variables using <code class="code">soong_config_*</code> modules that describe the module types, variables and possible values:</p><pre class="code">soong_config_module_type {
    name: "acme_cc_defaults",
    module_type: "cc_defaults",
    config_namespace: "acme",
    variables: ["board"],
    bool_variables: ["feature"],
    value_variables: ["width"],
    properties: ["cflags", "srcs"],
}

soong_config_string_variable {
    name: "board",
    values: ["soc_a", "soc_b"],
}
</pre><p>This example describes a new <code class="code">acme_cc_defaults</code> module type that extends the <code class="code">cc_defaults</code> module type, with three additional conditionals based on variables <code class="code">board</code>, <code class="code">feature</code> and <code class="code">width</code>, which can affect properties <code class="code">cflags</code> and <code class="code">srcs</code>.</p><p>The values of the variables can be set from a product's <code class="code">BoardConfig.mk</code> file:</p><pre class="code">SOONG_CONFIG_NAMESPACES += acme
SOONG_CONFIG_acme += \
    board \
    feature \

SOONG_CONFIG_acme_board := soc_a
SOONG_CONFIG_acme_feature := true
SOONG_CONFIG_acme_width := 200
</pre><p>The <code class="code">acme_cc_defaults</code> module type can be used anywhere after the definition in the file where it is defined, or can be imported into another file with:</p><pre class="code">soong_config_module_type_import {
    from: "device/acme/Android.bp",
    module_types: ["acme_cc_defaults"],
}
</pre><p>It can used like any other module type:</p><pre class="code">acme_cc_defaults {
    name: "acme_defaults",
    cflags: ["-DGENERIC"],
    soong_config_variables: {
        board: {
            soc_a: {
                cflags: ["-DSOC_A"],
            },
            soc_b: {
                cflags: ["-DSOC_B"],
            },
        },
        feature: {
            cflags: ["-DFEATURE"],
        },
        width: {
            cflags: ["-DWIDTH=%s"],
        },
    },
}

cc_library {
    name: "libacme_foo",
    defaults: ["acme_defaults"],
    srcs: ["*.cpp"],
}
</pre><p>With the <code class="code">BoardConfig.mk</code> snippet above, libacme_foo would build with cflags “-DGENERIC -DSOC_A -DFEATURE -DWIDTH=200”.</p><p><code class="code">soong_config_module_type</code> modules will work best when used to wrap defaults modules (<code class="code">cc_defaults</code>, <code class="code">java_defaults</code>, etc.), which can then be referenced by all of the vendor's other modules using the normal namespace and visibility rules.</p><h2><a class="h" name="Build-logic" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Build-logic"><span></span></a><a class="h" name="build-logic" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#build-logic"><span></span></a>Build logic</h2><p>The build logic is written in Go using the <a href="http://godoc.org/github.com/google/blueprint">blueprint</a> framework.  Build logic receives module definitions parsed into Go structures using reflection and produces build rules.  The build rules are collected by blueprint and written to a <a href="http://ninja-build.org/">ninja</a> build file.</p><h2><a class="h" name="Other-documentation" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Other-documentation"><span></span></a><a class="h" name="other-documentation" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#other-documentation"><span></span></a>Other documentation</h2><ul><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/best_practices.md">Best Practices</a></li><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/perf.md">Build Performance</a></li><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/clion.md">Generating CLion Projects</a></li><li><a href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/docs/compdb.md">Generating YouCompleteMe/VSCode compile_commands.json file</a></li><li>Make-specific documentation: <a href="https://android.googlesource.com/platform/build/+/master/README.md">build/make/README.md</a></li></ul><h2><a class="h" name="Developing-for-Soong" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Developing-for-Soong"><span></span></a><a class="h" name="developing-for-soong" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#developing-for-soong"><span></span></a>Developing for Soong</h2><p>To load Soong code in a Go-aware IDE, create a directory outside your android tree and then:</p><pre class="code"><span class="pln">apt install bindfs
export GOPATH</span><span class="pun">=&lt;</span><span class="pln">path to the directory you created</span><span class="pun">&gt;</span><span class="pln">
build</span><span class="pun">/</span><span class="pln">soong</span><span class="pun">/</span><span class="pln">scripts</span><span class="pun">/</span><span class="pln">setup_go_workspace_for_soong</span><span class="pun">.</span><span class="pln">sh
</span></pre><p>This will bind mount the Soong source directories into the directory in the layout expected by the IDE.</p><h3><a class="h" name="Running-Soong-in-a-debugger" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Running-Soong-in-a-debugger"><span></span></a><a class="h" name="running-soong-in-a-debugger" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#running-soong-in-a-debugger"><span></span></a>Running Soong in a debugger</h3><p>To run the soong_build process in a debugger, install <code class="code">dlv</code> and then start the build with <code class="code">SOONG_DELVE=&lt;listen addr&gt;</code> in the environment. For example:</p><pre class="code"><span class="pln">SOONG_DELVE</span><span class="pun">=:</span><span class="lit">1234</span><span class="pln"> m nothing
</span></pre><p>and then in another terminal:</p><pre class="code">dlv connect :1234
</pre><p>If you see an error:</p><pre class="code">Could not attach to pid 593: this could be caused by a kernel
security setting, try writing "0" to /proc/sys/kernel/yama/ptrace_scope
</pre><p>you can temporarily disable <a href="https://www.kernel.org/doc/Documentation/security/Yama.txt">Yama's ptrace protection</a> using:</p><pre class="code"><span class="pln">sudo sysctl </span><span class="pun">-</span><span class="pln">w kernel</span><span class="pun">.</span><span class="pln">yama</span><span class="pun">.</span><span class="pln">ptrace_scope</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
</span></pre><h2><a class="h" name="Contact" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#Contact"><span></span></a><a class="h" name="contact" href="https://android.googlesource.com/platform/build/soong/+/refs/heads/master/README.md#contact"><span></span></a>Contact</h2><p>Email <a href="mailto:android-building@googlegroups.com">android-building@googlegroups.com</a> (external) for any questions, or see <a href="http://go/soong">go/soong</a> (internal).</p></div></div></div><!-- default customFooter --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><div class="Footer-links"></div></div></footer></body></html>